<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Submissions - Nuvue Studio</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="icon" href="./image/favicon.png" />
    <!-- Font Awesome for icons, ensure it's linked if used in style.css or script.js -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>

<body>
    <!-- Header (Assuming it's loaded dynamically by script.js as in your original file) -->
    <header>
        <div id="header"></div>
    </header>

    <main>
        <!-- Banner Section -->
        <div class="section-banner">
            <div class="banner-layout-wrapper">
                <div class="banner-layout text-center">
                    <h2 class="title-heading">Contact Form Submissions</h2>
                    <nav class="breadcrumb">
                        <a href="./index.html">Home</a> /
                        <span class="current-page">Submissions</span>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Submissions Display Section -->
        <div class="section">
            <div class="hero-container">
                <div class="d-flex flex-column justify-content-center text-center gspace-5">
                    <div class="sub-heading align-self-center" data-animate="animate__fadeInDown">
                        <i class="fa-regular fa-circle-dot"></i>
                        <span>All Submissions</span>
                    </div>
                    <div id="submissions-list" class="">
                        <!-- Submissions will be loaded here by JavaScript -->
                        <p class="title-heading heading-container heading-container-medium">Loading submissions...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer (Assuming it's loaded dynamically by script.js as in your original file) -->
    <footer>
        <div id="footer"></div>
    </footer>

    <!-- Vendor Scripts -->
    <script src="js/vendor/jquery.min.js"></script>
    <script src="js/vendor/bootstrap.bundle.min.js"></script>
    <!-- Your custom script.js might handle header/footer loading -->
    <script src="js/script.js"></script>

    <!-- Firebase SDK + Data Fetching Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import {
            getFirestore,
            collection,
            getDocs,
            query,
            orderBy,
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
        import {
            initializeAppCheck,
            ReCaptchaV3Provider,
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";

        // IMPORTANT: Replace with your actual Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCiILxAGEaeCyD36Stl9C55DknuKG-qjH4", // Your API Key
            authDomain: "nuvue-studio.firebaseapp.com", // Your Auth Domain
            projectId: "nuvue-studio", // Your Project ID
            storageBucket: "nuvue-studio.firebasestorage.app", // Your Storage Bucket
            messagingSenderId: "524120386924", // Your Messaging Sender ID
            appId: "1:524120386924:web:94cf6cb0375bd984165749", // Your App ID
            measurementId: "G-NJND695368", // Your Measurement ID (if using Analytics)
        };

        // Initialize Firebase App
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Initialize App Check (IMPORTANT: Replace with your actual reCAPTCHA v3 site key)
        // If you are only fetching data and not worried about abuse for this specific page,
        // you *could* technically omit App Check here, but it's good practice to include it
        // if your Firebase project uses it generally.

        const submissionsList = document.getElementById("submissions-list");

        /**
         * Fetches and displays contact form submissions from Firestore.
         */
        async function fetchSubmissions() {
            submissionsList.innerHTML =
                '<p class="text-center text-muted"><i class="fas fa-spinner fa-spin me-2"></i> Loading submissions...</p>'; // Show loading message with spinner
            try {
                // Create a query to get documents from the "contacts" collection
                // Order by timestamp in descending order (latest first)
                const q = query(
                    collection(db, "contacts"),
                    orderBy("timestamp", "desc")
                );
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    submissionsList.innerHTML =
                        '<p class="text-center text-muted">No submissions found yet.</p>';
                    return;
                }

                let submissionsHtml = '<div class="card-package-wrapper flex-column gspace-3">';
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    // Convert Firebase Timestamp to a readable date string
                    const timestamp = data.timestamp
                        ? new Date(data.timestamp.toDate()).toLocaleString()
                        : "N/A";

                    submissionsHtml += `
                    
                        <div class="card-package-wrapper">
                            <div class="spacer"></div>
                            <div class="grid-spacer-2 align-items-stretch">
                                <div class="col">
                                    <div class="card card-pricing pricing-highlight">
                                        <div class="spacer"></div>
                                        <h4 class="card-package-title">From: ${data.firstName || "N/A"} ${data.lastName || "N/A"}</h4>
                                        <p class="text-center"><i>(${data.email || "N/A"})</i></p>

                                        <div class="pricing-container h-100 gspace-1 align-items-center">
                                            <div class="card card-package">
                                                <h4><i>Subject:</i></h4>
                                                <p>${data.subject || "N/A"}</p>
                                                <h4><i>Message:</i></h4>
                                                <p>${data.message || "N/A"}</p>
                                                <ul class="check-list">
                                                    <li>Submitted on: ${timestamp}</li>
                                                    <li>(Document ID: ${doc.id})</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                submissionsHtml += "</div>";
                submissionsList.innerHTML = submissionsHtml;
            } catch (error) {
                console.error("Error fetching documents: ", error);
                submissionsList.innerHTML = `
            <p class="text-center text-danger">
              <i class="fas fa-exclamation-triangle me-2"></i> Error loading submissions.
              Please check your console for details and ensure Firebase security rules allow read access.
            </p>
          `;
            }
        }

        // Fetch submissions when the page loads
        document.addEventListener("DOMContentLoaded", fetchSubmissions);
    </script>
</body>

</html>
